# patsy-db

Command-line client for preservation asset tracking system (PATSy)

## Project Branches

This project uses the "GitHub Flow" branching model (see
<https://confluence.umd.edu/display/LIB/GitHub+Flow+Model+for+Kubernetes+configuration+%28k8s-%29+repositories>)

The "main" branch represents version 2 (v2) of the "patsy-db" codebase, which
is incompatible with the "legacy" version 1 (v1) codebase.

Any work on the legacy patsy-db v1 application should be performed on the
"main-v1" branch.

## Development Setup

See [docs/DevelopmentSetup.md](docs/DevelopmentSetup.md).

## Patsy Commands

The "--help" flag provides information about available commands and arguments:

```
> patsy --help
```

The "--help" flag, coupled with a specific command shows additional information
about that command:

```
> patsy load --help
```

### Common Arguments

## "database" argument

The "--database" argument is used to specify the database the command should
run against.

For SQLite databases, this is typically the filename of the SQLite database
file.

### "schema" command

Creates the database schema.

```
> patsy --database <DATABASE> schema
```

Typically needs only needs to be done once, when the database is created.

### "load" command

Loads an "inventory" CSV file into the database.

```
> patsy --database <DATABASE> load <INVENTORY_CSV_FILE>
```

The "inventory" CSV file is typically generated by the "preserve"
(<https://github.com/umd-lib/preserve>) or "aws-archiver"
(<https://github.com/umd-lib/aws-archiver>) tools.

Each row of the CSV file contains information about the batch, accession,
and (optionally) location information about a preservation asset.

An accession is uniquely identified by its batch, and relative path (relpath)
fields. If an accession already exists, the "load" command will NOT update
the accession (even if the accession information in the CSV file is different).
Location information for an existing accession will be added, unless the
location already exists for that accession.

## Kubernetes

This application can be used with either SQLite or Postgres. For
development/testing purposes, use of SQLite is perfectly acceptable.

For production use, a Postgres database has been implemented in Kubernetes,
and a "patsy-db" CLI client is also available.

See the [README.md](https://github.com/umd-lib/k8s-patsy) in
<https://github.com/umd-lib/k8s-patsy> for more information about using the
"patsy-db" CLI client and accessing the Postgres database.

## Docker Image

This application provides a "Dockerfile" for generating a Docker image for
use in Kubernetes. The Dockerfile provides a sample build command.

In order to generate "clean" Docker images, the Docker images should be built
from a fresh clone of the GitHub repository.

## License

See the [LICENSE](LICENSE) file for license rights and limitations.
